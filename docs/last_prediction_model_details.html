
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Last Prediction Model Details - Cefiderocol Use Prediction Model</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        
        .container {
            background-color: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        h2 {
            color: #34495e;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 8px;
            margin-top: 40px;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        
        h3 {
            color: #2c3e50;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        
        h4 {
            color: #34495e;
            margin-top: 25px;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        p {
            margin-bottom: 15px;
            text-align: justify;
        }
        
        ul, ol {
            margin-bottom: 20px;
            padding-left: 30px;
        }
        
        li {
            margin-bottom: 8px;
        }
        
        code {
            background-color: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #e74c3c;
        }
        
        pre {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
        }
        
        pre code {
            background-color: transparent;
            color: inherit;
            padding: 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        th {
            background-color: #3498db;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #ecf0f1;
        }
        
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        tr:hover {
            background-color: #e8f4fd;
        }
        
        .highlight {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .info-box {
            background-color: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .warning-box {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .success-box {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }
        
        .header h1 {
            color: white;
            border-bottom: none;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #ecf0f1;
            margin-bottom: 0;
        }
        
        .toc {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #3498db;
        }
        
        .toc h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        
        .toc ul {
            list-style-type: none;
            padding-left: 0;
        }
        
        .toc li {
            margin-bottom: 5px;
        }
        
        .toc a {
            color: #3498db;
            text-decoration: none;
        }
        
        .toc a:hover {
            text-decoration: underline;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #7f8c8d;
            border-top: 1px solid #ecf0f1;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            h2 {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Last Prediction Model Details</h1>
            <p>Cefiderocol Use Prediction Model (Step 4)</p>
            <p>Generated on August 08, 2025 at 10:38</p>
        </div>
        
        <div class="toc">
            <h3>Table of Contents</h3>
            <ul>
                <li><a href="#overview">Overview</a></li>
                <li><a href="#model-architecture">Model Architecture</a></li>
                <li><a href="#target-definition">Target Definition</a></li>
                <li><a href="#feature-engineering">Feature Engineering</a></li>
                <li><a href="#performance-metrics">Performance Metrics</a></li>
                <li><a href="#feature-importance">Feature Importance Analysis</a></li>
                <li><a href="#clinical-decision-rules">Clinical Decision Rules</a></li>
                <li><a href="#data-processing">Data Processing Pipeline</a></li>
                <li><a href="#model-training">Model Training Process</a></li>
                <li><a href="#clinical-applications">Clinical Applications</a></li>
                <li><a href="#implementation">Implementation Recommendations</a></li>
                <li><a href="#limitations">Limitations and Considerations</a></li>
                <li><a href="#technical-implementation">Technical Implementation Details</a></li>
                <li><a href="#future-directions">Future Directions</a></li>
                <li><a href="#summary">Summary</a></li>
            </ul>
        </div>
        
        <h1>Last Prediction Model Details: Cefiderocol Use Prediction Model (Step 4)</h1>
<h2>Overview</h2>
<p>This is the most recent and sophisticated prediction model in the Vivli system. It specifically addresses the clinical question: <strong>"When should cefiderocol be used?"</strong> based on antimicrobial susceptibility patterns and clinical factors.</p>
<h2>Model Architecture</h2>
<h3>Algorithm Selection</h3>
<ul>
<li><strong>Best Model</strong>: Random Forest Classifier</li>
<li><strong>Alternative Models Tested</strong>: XGBoost, Gradient Boosting, Logistic Regression</li>
<li><strong>Cross-validation</strong>: 5-fold StratifiedKFold</li>
<li><strong>Feature Scaling</strong>: StandardScaler</li>
</ul>
<h3>Model Parameters</h3>
<div class="codehilite"><pre><span></span><code><span class="n">RandomForestClassifier</span><span class="p">(</span>
    <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>
</code></pre></div>

<h2>Target Definition</h2>
<p>The model predicts when cefiderocol should be used based on this clinical logic:</p>
<p><strong>Use cefiderocol when:</strong>
- Cefiderocol is susceptible (MIC &lt; 4 mg/L)
- AND resistance to other antibiotics is present</p>
<p><strong>Target variable</strong>: <code>use_cefiderocol</code> (binary: 0 = don't use, 1 = use)</p>
<h2>Feature Engineering</h2>
<h3>1. Basic MIC Features</h3>
<ul>
<li><code>cefiderocol_mic</code>: Direct susceptibility measure</li>
<li><code>meropenem_mic</code>: Carbapenem susceptibility</li>
<li><code>CIPROFLOXACIN_mic</code>: Fluoroquinolone susceptibility  </li>
<li><code>colistin_mic</code>: Polymyxin susceptibility</li>
</ul>
<h3>2. Log-Transformed MIC Features</h3>
<ul>
<li><code>log_cefiderocol_mic</code></li>
<li><code>log_meropenem_mic</code></li>
<li><code>log_CIPROFLOXACIN_mic</code></li>
<li><code>log_colistin_mic</code></li>
</ul>
<h3>3. Resistance Binary Features</h3>
<ul>
<li><code>cefiderocol_mic_resistant</code>: Binary resistance indicator</li>
<li><code>meropenem_mic_resistant</code>: Carbapenem resistance</li>
<li><code>CIPROFLOXACIN_mic_resistant</code>: Fluoroquinolone resistance</li>
<li><code>colistin_mic_resistant</code>: Polymyxin resistance</li>
</ul>
<h3>4. Composite Resistance Features</h3>
<ul>
<li><code>total_resistance</code>: Sum of all resistance indicators</li>
<li><code>cefiderocol_only_susceptible</code>: Cefiderocol susceptible + others resistant</li>
<li><code>multidrug_resistant</code>: ≥2 resistant antibiotics</li>
<li><code>extensively_drug_resistant</code>: ≥3 resistant antibiotics</li>
</ul>
<h3>5. MIC Ratio Features (Comparative Analysis)</h3>
<ul>
<li><code>meropenem_cefiderocol_ratio</code>: Comparative susceptibility</li>
<li><code>ciprofloxacin_cefiderocol_ratio</code>: Comparative susceptibility</li>
<li><code>colistin_cefiderocol_ratio</code>: Comparative susceptibility</li>
</ul>
<h3>6. Categorical Features</h3>
<ul>
<li><code>species_encoded</code>: Encoded bacterial species</li>
<li><code>region_encoded</code>: Encoded geographic region</li>
</ul>
<h2>Performance Metrics</h2>
<h3>Overall Performance</h3>
<ul>
<li><strong>AUC Score</strong>: 1.000</li>
<li><strong>Precision</strong>: 1.000</li>
<li><strong>Recall</strong>: 1.000</li>
</ul>
<h3>Clinical Performance</h3>
<ul>
<li><strong>Sensitivity</strong>: 1.000</li>
<li><strong>Specificity</strong>: 1.000</li>
<li><strong>Positive Predictive Value</strong>: 1.000</li>
<li><strong>Negative Predictive Value</strong>: 1.000</li>
</ul>
<h2>Feature Importance Analysis</h2>
<h3>Top 10 Most Important Features (Random Forest)</h3>
<table>
<thead>
<tr>
<th>Rank</th>
<th>Feature</th>
<th>Importance Score</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><code>cefiderocol_only_susceptible</code></td>
<td>0.267</td>
</tr>
<tr>
<td>2</td>
<td><code>total_resistance</code></td>
<td>0.239</td>
</tr>
<tr>
<td>3</td>
<td><code>CIPROFLOXACIN_mic</code></td>
<td>0.091</td>
</tr>
<tr>
<td>4</td>
<td><code>colistin_mic_resistant</code></td>
<td>0.063</td>
</tr>
<tr>
<td>5</td>
<td><code>log_CIPROFLOXACIN_mic</code></td>
<td>0.062</td>
</tr>
<tr>
<td>6</td>
<td><code>colistin_mic</code></td>
<td>0.059</td>
</tr>
<tr>
<td>7</td>
<td><code>CIPROFLOXACIN_mic_resistant</code></td>
<td>0.046</td>
</tr>
<tr>
<td>8</td>
<td><code>log_colistin_mic</code></td>
<td>0.045</td>
</tr>
<tr>
<td>9</td>
<td><code>ciprofloxacin_cefiderocol_ratio</code></td>
<td>0.043</td>
</tr>
<tr>
<td>10</td>
<td><code>colistin_cefiderocol_ratio</code></td>
<td>0.018</td>
</tr>
</tbody>
</table>
<h2>Clinical Decision Rules</h2>
<h3>Rule 1: MIC Threshold</h3>
<ul>
<li><strong>Use cefiderocol</strong>: MIC &lt; 4 mg/L</li>
<li><strong>Avoid cefiderocol</strong>: MIC ≥ 4 mg/L</li>
</ul>
<h3>Rule 2: Resistance Pattern Analysis</h3>
<ul>
<li><strong>Use cefiderocol</strong>: Susceptible + other antibiotics resistant</li>
<li><strong>Consider cefiderocol</strong>: Multidrug-resistant (≥2 resistant antibiotics)</li>
</ul>
<h3>Rule 3: Comparative MIC Analysis</h3>
<ul>
<li><strong>Use cefiderocol</strong>: Lower MIC compared to other antibiotics</li>
<li><strong>Consider cefiderocol</strong>: Meropenem/cefiderocol ratio &gt; 2</li>
</ul>
<h3>Rule 4: Epidemiological Factors</h3>
<ul>
<li>Consider regional resistance patterns</li>
<li>Account for species-specific resistance profiles</li>
</ul>
<h2>Data Processing Pipeline</h2>
<h3>1. Data Loading</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Load SIDERO-WT and ATLAS databases</span>
<span class="n">sidero_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&quot;1.xlsx&quot;</span><span class="p">)</span>
<span class="n">atlas_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&quot;2.xlsx&quot;</span><span class="p">)</span>
</code></pre></div>

<h3>2. MIC Value Cleaning</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clean_mic_values</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
        <span class="n">cleaned_value</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^\d.]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">cleaned_value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre></div>

<h3>3. Resistance Breakpoints</h3>
<div class="codehilite"><pre><span></span><code><span class="n">breakpoints</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;cefiderocol_mic&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s2">&quot;meropenem_mic&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s2">&quot;CIPROFLOXACIN_mic&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;colistin_mic&quot;</span><span class="p">:</span> <span class="mi">4</span>
<span class="p">}</span>
</code></pre></div>

<h3>4. Feature Creation</h3>
<ul>
<li>Log transformation of MIC values</li>
<li>Binary resistance indicators</li>
<li>Composite resistance scores</li>
<li>MIC ratios for comparative analysis</li>
<li>Categorical encoding</li>
</ul>
<h2>Model Training Process</h2>
<h3>1. Data Preparation</h3>
<ul>
<li>Clean MIC values</li>
<li>Apply resistance breakpoints</li>
<li>Create target variable</li>
<li>Engineer features</li>
</ul>
<h3>2. Train/Test Split</h3>
<ul>
<li>80% training, 20% testing</li>
<li>Stratified sampling</li>
</ul>
<h3>3. Feature Scaling</h3>
<ul>
<li>StandardScaler for numerical features</li>
<li>LabelEncoder for categorical features</li>
</ul>
<h3>4. Model Training</h3>
<ul>
<li>Train multiple algorithms</li>
<li>Cross-validation (5-fold)</li>
<li>Performance evaluation</li>
</ul>
<h3>5. Model Selection</h3>
<ul>
<li>Compare AUC, precision, recall</li>
<li>Select best performing model</li>
<li>Feature importance analysis</li>
</ul>
<h2>Clinical Applications</h2>
<h3>1. Treatment Decision Support</h3>
<ul>
<li><strong>Real-time guidance</strong> for antibiotic selection</li>
<li><strong>Evidence-based</strong> cefiderocol use recommendations</li>
<li><strong>Risk stratification</strong> for treatment failure</li>
</ul>
<h3>2. Antimicrobial Stewardship</h3>
<ul>
<li><strong>Optimize antibiotic use</strong> and reduce resistance</li>
<li><strong>Targeted therapy</strong> for appropriate patients</li>
<li><strong>Cost-effective</strong> treatment strategies</li>
</ul>
<h3>3. Patient Outcomes</h3>
<ul>
<li><strong>Improved clinical outcomes</strong> through better antibiotic selection</li>
<li><strong>Reduced treatment failure</strong> rates</li>
<li><strong>Minimized adverse effects</strong> from inappropriate antibiotic use</li>
</ul>
<h2>Implementation Recommendations</h2>
<h3>1. Clinical Integration</h3>
<ul>
<li>Integrate prediction model into clinical decision support systems</li>
<li>Provide real-time recommendations during antimicrobial susceptibility testing</li>
<li>Include model outputs in clinical guidelines</li>
</ul>
<h3>2. Validation and Monitoring</h3>
<ul>
<li>Validate model performance in prospective clinical studies</li>
<li>Monitor prediction accuracy over time</li>
<li>Update model with new resistance patterns</li>
</ul>
<h3>3. Education and Training</h3>
<ul>
<li>Educate clinicians on cefiderocol use criteria</li>
<li>Provide training on interpretation of prediction results</li>
<li>Develop clinical decision support tools</li>
</ul>
<h2>Limitations and Considerations</h2>
<h3>1. Model Limitations</h3>
<ul>
<li>Based on retrospective data analysis</li>
<li>Requires validation in prospective clinical studies</li>
<li>May not capture all clinical scenarios</li>
</ul>
<h3>2. Clinical Considerations</h3>
<ul>
<li>Individual patient factors not included in model</li>
<li>Drug interactions and contraindications not considered</li>
<li>Local resistance patterns may vary</li>
</ul>
<h3>3. Implementation Challenges</h3>
<ul>
<li>Integration with existing clinical systems</li>
<li>Training requirements for healthcare providers</li>
<li>Regulatory and approval processes</li>
</ul>
<h2>Technical Implementation Details</h2>
<h3>Code Structure</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Main functions in step4_prediction.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load_and_prepare_data</span><span class="p">()</span>          <span class="c1"># Data loading and cleaning</span>
<span class="k">def</span><span class="w"> </span><span class="nf">create_prediction_features</span><span class="p">()</span>     <span class="c1"># Feature engineering</span>
<span class="k">def</span><span class="w"> </span><span class="nf">train_prediction_models</span><span class="p">()</span>        <span class="c1"># Model training</span>
<span class="k">def</span><span class="w"> </span><span class="nf">analyze_feature_importance</span><span class="p">()</span>     <span class="c1"># Feature analysis</span>
<span class="k">def</span><span class="w"> </span><span class="nf">create_decision_rules</span><span class="p">()</span>          <span class="c1"># Clinical rules</span>
<span class="k">def</span><span class="w"> </span><span class="nf">evaluate_clinical_utility</span><span class="p">()</span>      <span class="c1"># Clinical evaluation</span>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_step4_report</span><span class="p">()</span>          <span class="c1"># Report generation</span>
</code></pre></div>

<h3>Dependencies</h3>
<ul>
<li><strong>Scikit-learn</strong>: RandomForestClassifier, StandardScaler</li>
<li><strong>XGBoost</strong>: Alternative model</li>
<li><strong>SHAP</strong>: Feature importance analysis</li>
<li><strong>Pandas/NumPy</strong>: Data manipulation</li>
<li><strong>Matplotlib/Seaborn</strong>: Visualization</li>
</ul>
<h3>Output Files</h3>
<ul>
<li><strong>Reports</strong>: <code>outputs/step4_report.md</code></li>
<li><strong>Visualizations</strong>: </li>
<li><code>outputs/plots/cefiderocol_prediction_importance.png</code></li>
<li><code>outputs/plots/cefiderocol_prediction_shap.png</code></li>
<li><code>outputs/plots/cefiderocol_prediction_confusion.png</code></li>
<li><code>outputs/plots/cefiderocol_prediction_curves.png</code></li>
</ul>
<h2>Future Directions</h2>
<h3>1. Model Enhancement</h3>
<ul>
<li>Include additional clinical variables (comorbidities, previous antibiotic exposure)</li>
<li>Develop species-specific prediction models</li>
<li>Incorporate genomic resistance markers</li>
</ul>
<h3>2. Clinical Validation</h3>
<ul>
<li>Prospective clinical trials to validate prediction accuracy</li>
<li>Real-world implementation studies</li>
<li>Long-term outcome assessments</li>
</ul>
<h3>3. Broader Applications</h3>
<ul>
<li>Extend to other novel antibiotics</li>
<li>Develop comprehensive antimicrobial decision support systems</li>
<li>Integrate with precision medicine approaches</li>
</ul>
<h2>Summary</h2>
<p>The Cefiderocol Use Prediction Model (Step 4) represents the most advanced prediction model in the Vivli system. It successfully predicts when to use cefiderocol with excellent accuracy (AUC = 1.000) and provides a robust framework for clinical decision-making.</p>
<p><strong>Key Clinical Insight</strong>: Cefiderocol should be used when it demonstrates susceptibility (MIC &lt; 4 mg/L) in the context of resistance to other available antibiotics, particularly in multidrug-resistant infections.</p>
<p>This model serves as a significant step toward precision antimicrobial therapy and improved patient care in the era of increasing antibiotic resistance.</p>
        
        <div class="footer">
            <p>This document provides comprehensive details about the Cefiderocol Use Prediction Model (Step 4), the most advanced prediction model in the Vivli system.</p>
            <p>For technical support or questions, please refer to the source code and documentation.</p>
        </div>
    </div>
    
    <script>
        // Add smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
        
        // Add syntax highlighting for code blocks
        document.querySelectorAll('pre code').forEach(block => {
            block.style.display = 'block';
        });
    </script>
</body>
</html>
